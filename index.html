<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Comparatif PIB / Violences par armes √† feu</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>

</head>

<body>
    <div id="intro-scene">
        <div class="intro-text">Violences par armes √† feu et PIB</div>
        <div class="intro-text-2">Par Boris Rocchietti</div>
        <div class="gun-icon" id="gun1"> <img src="gun.png" alt="gun_icon"></div>
        <div class="gun-icon" id="gun2"><img src="gun.png" alt="gun_icon"></div>
        <div class="bullet-icon" id="bullet1"></div>
        <div class="bullet-icon" id="bullet2"></div>
    </div>

    <header>
        <div class="header-top">
            <div class="logo">
                <img src="logo.png" alt="Logo Ponimat">
                <div class="logo-text">
                    <span>Ponimat - Depuis 1962</span>
                    <p>"Celui qui a invent√© le bateau a aussi invent√© le naufrage"</p>
                </div>
            </div>
            <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
        </div>
        <hr class="menu-separator" id="separator">
        <nav id="menu" class="hidden">
            <ul>
                <li><a href="#contexte">Bref contexte</a></li>
                <li><a href="#graphiques">Quelques graphiques</a></li>
                <li><a href="#carte-pib">Carte interactive </a></li>
            </ul>
        </nav>
        <button id="openModal" class="modal-trigger">üéµ</button>
    </header>

    <main>
        <section>
            <div id="musicModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h1>Playlist immersive</h1>
                    <p>Ce site s'accompagne d'une playlist pour √™tre plus immersif.
                        Pour arr√™ter la musique, appuyer √† nouveau sur la m√™me touche. Si c'est sur O, appuyez de
                        nouveau
                        sur O.
                        Pour acc√©der aux titres, appuyer sur
                        les touches suivantes :</p>
                    <ul class="key-list">
                        <li><kbd>N</kbd> _ Nobody Hurt No One -
                            <span style="color: #d2c2c2; font-weight: bold;">Natalia Podolskaya</span> ~
                            <span style="font-style: italic;"> 3:19</span>
                        </li>
                        <li><kbd>O</kbd> _ Can You Hear The Music -
                            <span style="color: #d2c2c2; font-weight: bold;">Oppenheimer Soundtrack</span> ~
                            <span style="font-style: italic;"> 1:50</span>
                        </li>
                        <li><kbd>T</kbd> _ Doom Theme ~ <span style="font-style: italic;"> 1:38</span></li>
                        <li><kbd>U</kbd> _ Under The Same Sun -
                            <span style="color: #d2c2c2; font-weight: bold;">Scorpions</span> ~
                            <span style="font-style: italic;"> 4:53</span>
                        </li>
                        <li><kbd>W</kbd> _ News From The War -
                            <span style="color: #d2c2c2; font-weight: bold;">Dreams We've Had</span> ~
                            <span style="font-style: italic;"> 4:44 </span>
                        </li>
                        <li><kbd>A</kbd>_ Crystal Valley -
                            <span style="color: #d2c2c2; font-weight: bold;">Daisuke Kashiwa</span> ~
                            <span style="font-style: italic;"> 6:01</span>
                        </li>
                        <li><kbd>R</kbd>_ Le Jardinier Du Couvent -
                            <span style="color: #d2c2c2; font-weight: bold;">Malicorne </span> ~
                            <span style="font-style: italic;"> 9:03</span>
                        </li>
                    </ul>
                </div>
            </div>

            <h1 class="at-item" id="contexte">Bref contexte</h1>

            <div class="explications">
                <p> A la racine de ce projet, il y a une question. Quel lien peut-on faire entre les statistiques li√©es
                    aux armes √† feu, et le PIB d'un Etat ?
                    Est-ce qu'√™tre un √©tat d√©velopp√© comme la France ou les Etats-Unis implique toujours que votre pays
                    sera plus s√©curis√©, et plus strict ?
                    Ou au contraire, est-ce que la richesse d'un pays n'emp√™che rien ?
                    <br><br>
                    J'ai donc regroup√© deux ensembles de donn√©es :
                <ul>
                    <li>Les donn√©es sur la possession d'armes √† feu, les taux de mortalit√© par armes √† feu, et les
                        suicides par armes √† feu, trouv√© sur le site Kaggle.</li>
                    <li>Les donn√©es sur le PIB, provenant de la Banque Mondiale en 2024.</li>
                </ul>
                <br>
                Les armes √† feu, comme tous les outils, ont un grand nombre d'utilisations possibles. Je ne parlerais
                pas de tir sportif, ou de chasseurs. Ici, je me concentrerais plut√¥t sur les meurtres, ou les suicides
                que les armes causent.
                En parlant de cela, je tenais √† noter que ces donn√©es ne s'int√©ressant principalement qu'aux armes √†
                feu, on pourrait se m√©prendre sur certaines r√©alit√©s.
                Par exemple, on pourrait croire que la Cor√©e du Sud a un taux de suicide de 0,04 pour 100 000 habitants,
                mais c'est une
                m√©prise, parce que c'est un taux de suicide <span style="font-style: italic;">seulement par arme √†
                    feu</span>.
                La Cor√©e du Sud, si on consid√®re le taux de suicide avec toutes les m√©thodes employ√©es, grimpe √†
                <span style="font-style: italic; color:#ff3643;">27,5 personnes pour 100 000 habitants</span>.
                Le seul pays au dessus, le Lesotho, royaume enclav√© dans l'Afrique du Sud, plafonne aux alentours de
                <span style="font-style: italic; color:#ff3643;">29 personnes pour 100 000 habitants</span>.
                </p>
            </div>
        </section>

        <h1 class="at-item" id="graphiques">Quelques graphiques...</h1>
        <div class="graph-stack">
            <div id="chartBest" class="chart-box"></div>
            <div id="chartWorst" class="chart-box"></div>
            <div id="chartRatioBest" class="chart-box"></div>
            <div class="options-neon">
                <label for="countryFilter">Filtrer les pays : </label>
                <select id="countryFilter" class="neon-2">
                    <option value="top10">Top 10 PIB les plus √©lev√©s (en moyenne)</option>
                    <option value="bottom10">Top 10 PIB les plus faibles (en moyenne)</option>
                    <option value="random10"> <button onclick="refreshChart()">10 pays al√©atoires</button></option>
                </select>
            </div>
            <div id="3D" class="chart-box"></div>
        </div>

        <h1 class="at-item" id="carte-pib">Carte Interactive : Possession d'armes et PIB</h1>

        <div style="margin-left:4rem;">
            <p style=" font-size:1.1rem;  font-weight: bold;  display:inline; margin-right:10px; color: white;">
                Evolution du PIB :</p>
            <button id="playTimeline" class="neon">‚ñ∂Ô∏è Lecture</button>
            <button id="pauseTimeline" class="neon">‚è∏Ô∏è Pause</button>

            <input type="range" id="timelineSlider" min="0" max="0" value="0" style="width:300px; margin-left:10px;">
            <span id="timelineYear"></span>
        </div>

        <div style="margin-left:4rem; ">
            <label for="indicator">Indicateur principal : </label>
            <select id="indicator" class="neon-2">
                <option value="guns">Armes √† feu</option>
                <option value="gdp">PIB</option>
            </select>

            <label for="gunsField">Variable armes : </label>
            <select id="gunsField" class="neon-2">
                <option value="Estimate of civilian firearms per 100 persons">Armes pour 100 personnes</option>
                <option value="Registered firearms">Armes enregistr√©es par pays</option>
                <option value="Unregistered firearms">Armes non enregistr√©es par pays</option>
                <option value="Gun Death Rate">Taux mortalit√© armes par pays</option>
                <option value="Suicide Rate by Firearm">Suicides par arme √† feu par pays</option>
            </select>

            <label for="gdpYear">Ann√©e PIB : </label>
            <select id="gdpYear" class="neon-2"></select>
        </div>

        <div id="map"></div>
        <div id="yearOverlay"></div>
        <script src="carte.js"></script>
    </main>

    <footer class="piedepage">
        <div class="explications"> R√©alis√© par Boris Rocchietti ¬©2025</div>
        <audio id="audioPlayer" style="display:none;"></audio>
    </footer>
    <script>



        function formatMoney(n) {
            if (n === null || n === undefined) return '-';
            const num = Number(n);
            if (!isFinite(num)) return '-';
            const abs = Math.abs(num);
            if (abs >= 1e12) return (num / 1e12).toFixed(2) + '$ (x10^12)';
            if (abs >= 1e9) return (num / 1e9).toFixed(2) + ' $ (x10^9)';
            if (abs >= 1e6) return (num / 1e6).toFixed(2) + ' $ (x10^6)';
            return num.toLocaleString();
        };

        function formatNumber(n) {
            return formatMoney(n);
        };

        document.addEventListener('DOMContentLoaded', (event) => {

            const DATA = {
                best: {
                    countries: ['Japon', 'Royaume-Uni', 'Allemagne', 'Singapour', 'Indon√©sie', 'Espagne', 'Pologne', 'France', 'Australie', 'Arabie Saoudite'],
                    gdp: [4026210821147, 3643834188783, 4659929336891, 547386645892, 1396300098191, 1722745978335, 914696430325, 3162079073496, 1752193307380, 1237529866667],
                    rate: [0.02, 0.04, 0.08, 0.01, 0.06, 0.13, 0.08, 0.32, 0.18, 0.17]
                },
                worst: {
                    countries: ['Nauru', 'Dominique', 'Belize', '√éles Marshall', 'Palau', 'Lesotho', 'Comores', 'Guin√©e-Bissau', '√éles Salomon', 'Salvador'],
                    gdp: [160350639.5, 688881481.5, 3515783329, 280357844.2, 281849100, 2271541846, 1546164420, 2119865935, 1760767447, 35364960000],
                    rate: [1.18, 3.53, 15.04, 1.07, 0.78, 5.3, 3.16, 3.43, 1.91, 35.5]
                }
            };

            DATA.best.ratio = DATA.best.gdp.map((g, i) => g / DATA.best.rate[i]);
            DATA.worst.ratio = DATA.worst.gdp.map((g, i) => g / DATA.worst.rate[i]);


            function createBarLineChart(domId, title, countries, gdp, rates, rateMax) {
                const chartElement = document.getElementById(domId);
                if (!chartElement) {
                    console.error(`Conteneur ECharts non trouv√© : #${domId}`);
                    return;
                }
                const chart = echarts.init(chartElement);

                chart.setOption({
                    title: { text: title, left: 10 },
                    grid: {
                        left: window.innerWidth < 768 ? '10%' : 100,
                        right: window.innerWidth < 768 ? '10%' : 100,
                        top: 80,
                        bottom: window.innerWidth < 768 ? 60 : 80
                    },
                    legend: { data: ['PIB (US$)', 'Taux d√©c√®s / 100k'], bottom: 10 },
                    tooltip: {
                        trigger: 'axis',
                        formatter: params => {
                            const i = params[0].dataIndex;
                            return `
                                <b>${countries[i]}</b><br>
                                ${params[0].marker} PIB : ${formatMoney(gdp[i])}<br>
                                ${params[1].marker} Taux : ${rates[i]}
                                `;
                        }
                    },
                    xAxis: {
                        type: 'category',
                        data: countries,
                        axisLabel: {
                            rotate: 15,
                            fontSize: 11
                        }
                    },
                    yAxis: [
                        {
                            type: 'value',
                            name: 'PIB (US$)',
                            position: 'left',
                            nameTextStyle: {
                                color: '#001d3d',
                                fontWeight: 'bold'
                            },
                            axisLabel: {
                                formatter: val => formatMoney(val),
                                color: '#001d3d'
                            },
                            axisLine: {
                                show: true,
                                lineStyle: { color: '#001d3d' }
                            },
                            splitLine: { show: false }
                        },
                        {
                            type: 'value',
                            name: 'Taux d√©c√®s / 100k',
                            position: 'right',
                            min: 0,
                            max: rateMax,
                            nameTextStyle: {
                                color: '#ff3643',
                                fontWeight: 'bold'
                            },
                            axisLabel: {
                                color: '#ff3643'
                            },
                            axisLine: {
                                show: true,
                                lineStyle: { color: '#ff3643' }
                            },
                            splitLine: { show: false }
                        }
                    ],
                    series: [
                        {
                            name: 'PIB (US$)',
                            type: 'bar',
                            data: gdp,
                            itemStyle: { color: '#001d3d' },
                            barMaxWidth: 40
                        },
                        {
                            name: 'Taux d√©c√®s / 100k',
                            type: 'line',
                            yAxisIndex: 1,
                            data: rates,
                            itemStyle: { color: '#ff3643' },
                            lineStyle: { width: 3, color: '#ff3643' },
                            symbolSize: 10
                        }
                    ]
                });
            }

            function createRatioChart(domId, title, countries, ratios) {
                const chartElement = document.getElementById(domId);
                if (!chartElement) {
                    console.error(`Conteneur ECharts non trouv√© : #${domId}`);
                    return;
                }
                const chart = echarts.init(chartElement);

                chart.setOption({
                    title: { text: title, left: 10 },
                    grid: { left: 80, right: 80, top: 80, bottom: 80 },
                    xAxis: { type: 'category', data: countries },
                    yAxis: { type: 'value', name: 'Ratio PIB/Taux', nameTextStyle: { fontWeight: 'bold' }, axisLabel: { formatter: val => formatMoney(val) }, axisLine: { lineStyle: { color: '#001d3d' } }, splitLine: { show: false } },
                    tooltip: {
                        trigger: 'axis',
                        formatter: params => {
                            const i = params[0].dataIndex;
                            return `<b>${countries[i]}</b>
                            <br>Ratio : <b>${formatMoney(ratios[i])}</b>`;
                        }
                    },
                    series: [
                        { type: 'bar', data: ratios, itemStyle: { color: '#001d3d' }, barMaxWidth: 40, }
                    ]
                });
            }

            // --- Initialisation des 3 graphiques ---
            createBarLineChart(
                'chartBest',
                'Top 10 Pays avec le meilleur rapport PIB vs Taux de d√©c√®s',
                DATA.best.countries,
                DATA.best.gdp,
                DATA.best.rate,
                0.35
            );

            createBarLineChart(
                'chartWorst',
                'Top 10 Pays avec le pire rapport PIB vs Taux de d√©c√®s',
                DATA.worst.countries,
                DATA.worst.gdp,
                DATA.worst.rate,
                40
            );

            createRatioChart(
                'chartRatioBest',
                'Dix meilleurs ratios PIB / Taux de d√©c√®s',
                DATA.best.countries,
                DATA.best.ratio
            );
        });

        /*Musique*/

        var modal = document.getElementById("musicModal");
        var btn = document.getElementById("openModal");
        var span = document.getElementsByClassName("close")[0];


        btn.onclick = function () {
            modal.style.display = "block";
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        var n = true;
        var o = true;
        var t = true;
        var u = true;
        var w = true;
        var a = true;
        var r = true;

        var player = document.getElementById('audioPlayer');

        $(document).keyup(function (e) {
            console.log("One of the keys is up");
            var code = e.keyCode || e.which;
            var pressedChar = String.fromCharCode(code).toLowerCase();
            switch (pressedChar) {

                case 'n':
                    if (n) {
                        player.setAttribute("src", "assets/nobodyhurt.mp3");
                        player.play();
                        n = false;
                    } else {
                        player.pause();
                        n = true;
                    }
                    break;

                case 'o':
                    if (o) {
                        player.setAttribute("src", "assets/oppenheimer.mp3");
                        player.play();
                        o = false;
                    } else {
                        player.pause();
                        o = true;
                    }
                    break;

                case 't':
                    if (t) {
                        player.setAttribute("src", "assets/doomtheme.mp3");
                        player.play();
                        t = false;
                    } else {
                        player.pause();
                        t = true;
                    }
                    break;

                case 'u':
                    if (u) {
                        player.setAttribute("src", "assets/underthesamesun.mp3");
                        player.play();
                        u = false;
                    } else {
                        player.pause();
                        u = true;
                    }
                    break;

                case 'w':
                    if (w) {
                        player.setAttribute("src", "assets/newsfromthewar.mp3");
                        player.play();
                        w = false;
                    } else {
                        player.pause();
                        w = true;
                    }
                    break;

                case 'a':
                    if (a) {
                        player.setAttribute("src", "assets/crystalvalley.mp3");
                        player.play();
                        a = false;
                    } else {
                        player.pause();
                        a = true;
                    }
                    break;

                case 'r':
                    if (r) {
                        player.setAttribute("src", "assets/jardinier.mp3");
                        player.play();
                        r = false;
                    } else {
                        player.pause();
                        r = true;
                    }
                    break;
            }
        });

        var lastSong = null;

        player.addEventListener('ended', function () {
            var keys = ['n', 'o', 't', 'u', 'w', 'a', 'r'];

            var song;

            do {
                song = keys[Math.floor(Math.random() * keys.length)];
            } while (song === lastSong && keys.length > 1);

            lastSong = song;

            var titles = {
                'n': 'assets/nobodyhurt.mp3',
                'o': 'assets/oppenheimer.mp3',
                't': 'assets/doomtheme.mp3',
                'u': 'assets/underthesamesun.mp3',
                'w': 'assets/newsfromthewar.mp3',
                'a': 'assets/crystalvalley.mp3',
                'r': 'assets/jardinier.mp3'
            };

            player.setAttribute("src", titles[song]);
            player.play();

            switch (song) {
                case 'n': n = false; break;
                case 'o': o = false; break;
                case 't': t = false; break;
                case 'u': u = false; break;
                case 'w': w = false; break;
                case 'a': a = false; break;
                case 'r': r = false; break;
            }

            console.log("Morceau suivant : " + song.toUpperCase());
        });

         // Fonction Hamburger
        function toggleMenu() {
            const menu = document.getElementById("menu");
            const separator = document.getElementById("separator");
            menu.classList.toggle("hidden");
            separator.classList.toggle("hidden");
        }

        window.addEventListener('resize', function () {
            const menu = document.getElementById("menu");
            if (window.innerWidth > 768) {
                menu.classList.remove("hidden");
            } else {
                menu.classList.add("hidden");
            }
        });

        window.dispatchEvent(new Event('resize'));
    </script>
    <script src="intro.js"></script>
    <script src="3d.js"></script>
</body>

</html>